(function(){var c=CKEDITOR.tools.cssLength;var b=function(e){var f=this.id;if(!e.info){e.info={};}e.info[f]=this.getValue();};function a(m){var h=0,g=0;for(var f=0,n,o=m.$.rows.length;f<o;f++){n=m.$.rows[f],h=0;for(var e=0,k,l=n.cells.length;e<l;e++){k=n.cells[e];h+=k.colSpan;}h>g&&(g=h);}return g;}function d(f,h){var e=function(i){return new CKEDITOR.dom.element(i,f.document);};var g=f.plugins.dialogadvtab;return{title:f.lang.grid.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var i=this;var j=i.getContentElement("advanced","advStyles");if(j){j.on("change",function(l){var n=this.getStyle("width",""),o=i.getContentElement("info","txtWidth");o&&o.setValue(n,true);var k=this.getStyle("height",""),m=i.getContentElement("info","txtHeight");m&&m.setValue(k,true);});}},onShow:function(){var o=f.getSelection(),k=o.getRanges(),n=null;var j=this.getContentElement("info","txtRows"),m=this.getContentElement("info","txtCols"),l=this.getContentElement("info","txtWidth"),i=this.getContentElement("info","txtHeight");isgrid=this.getContentElement("info","isgrid");if(h=="gridProperties"){if((n=o.getSelectedElement())){n=n.getAscendant("table",true);}else{if(k.length>0){if(CKEDITOR.env.webkit){k[0].shrink(CKEDITOR.NODE_ELEMENT);}var p=k[0].getCommonAncestor(true);n=p.getAscendant("table",true);}}this._.selectedElement=n;}if(n){this.setupContent(n);j&&j.disable();m&&m.disable();}else{j&&j.enable();m&&m.enable();}l&&l.onChange();i&&i.onChange();},onOk:function(){var F=f.getSelection(),B=this._.selectedElement&&F.createBookmarks();var z=this._.selectedElement||e("table"),D=this,E={};this.commitContent(E,z);if(E.info){var A=E.info;if(!this._.selectedElement){var k=z.append(e("tbody")),t=parseInt(A.txtRows,10)||0,u=parseInt(A.txtCols,10)||0;for(var x=0;x<t;x++){var l=e("tr");l.setAttribute("class","tr-info");var r=k.append(l);for(var w=0;w<u;w++){var s=e("td");s.setAttribute("class","td-info");var o=r.append(s);if(!CKEDITOR.env.ie){o.append(e("br"));}}}}var p=A.selHeaders;if(!z.$.tHead&&(p=="row"||p=="both")){var y=new CKEDITOR.dom.element(z.$.createTHead());k=z.getElementsByTag("tbody").getItem(0);var n=k.getElementsByTag("tr").getItem(0);for(x=0;x<n.getChildCount();x++){var q=n.getChild(x);if(q.type==CKEDITOR.NODE_ELEMENT&&!q.data("cke-bookmark")){q.renameNode("th");q.setAttribute("scope","col");}}y.append(n.remove());}if(z.$.tHead!==null&&!(p=="row"||p=="both")){y=new CKEDITOR.dom.element(z.$.tHead);k=z.getElementsByTag("tbody").getItem(0);var m=k.getFirst();while(y.getChildCount()>0){n=y.getFirst();for(x=0;x<n.getChildCount();x++){var v=n.getChild(x);if(v.type==CKEDITOR.NODE_ELEMENT){v.renameNode("td");v.removeAttribute("scope");}}n.insertBefore(m);}y.remove();}if(!this.hasColumnHeaders&&(p=="col"||p=="both")){for(r=0;r<z.$.rows.length;r++){v=new CKEDITOR.dom.element(z.$.rows[r].cells[0]);v.renameNode("th");v.setAttribute("scope","row");}}if((this.hasColumnHeaders)&&!(p=="col"||p=="both")){for(x=0;x<z.$.rows.length;x++){r=new CKEDITOR.dom.element(z.$.rows[x]);if(r.getParent().getName()=="tbody"){v=new CKEDITOR.dom.element(r.$.cells[0]);v.renameNode("td");v.removeAttribute("scope");}}}A.txtHeight?z.setStyle("height",A.txtHeight):z.removeStyle("height");A.txtWidth?z.setStyle("width",A.txtWidth):z.removeStyle("width");z.setAttribute("cellSpacing",1);z.setAttribute("cellPadding",0);z.setAttribute("class","form-info");z.setAttribute("isdetail","true");if(!z.getAttribute("style")){z.removeAttribute("style");}}if(!this._.selectedElement){f.insertElement(z);setTimeout(function(){var j=new CKEDITOR.dom.element(z.$.rows[0].cells[0]);var i=new CKEDITOR.dom.range(f.document);i.moveToPosition(j,CKEDITOR.POSITION_AFTER_START);i.select(1);},0);}else{try{F.selectBookmarks(B);}catch(C){}}},contents:[{id:"info",label:f.lang.table.title,elements:[{id:"txtname",type:"text",label:f.lang.grid.tablename,validate:CKEDITOR.dialog.validate.colNameValidate(f.lang.grid.tablename+f.lang.dcommon.colNameValidate),"default":"",accessKey:"T",width:"100%",setup:function(i){this.setValue(i.getAttribute("txtname"));},commit:function(j,i){i.setAttribute("txtname",this.getValue());}},{id:"isgrid",type:"checkbox",label:f.lang.grid.detailgrid,"default":"checked",accessKey:"P",value:"checked",setup:function(i){var j=i.getAttribute("isgrid");if(j==1){this.setValue(true);}},commit:function(k,i){var j=this.getValue();if(j){i.setAttribute("isgrid","true");}else{i.setAttribute("isgrid","false");}}},{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":2,label:f.lang.table.rows,required:true,controlStyle:"width:5em",validate:function(){var i=true,j=this.getValue();i=i&&CKEDITOR.dialog.validate.integer()(j)&&j>0;if(!i){alert(f.lang.table.invalidRows);this.select();}return i;},setup:function(i){this.setValue(i.$.rows.length);},commit:b},{type:"text",id:"txtCols","default":2,label:f.lang.table.columns,required:true,controlStyle:"width:5em",validate:function(){var i=true,j=this.getValue();i=i&&CKEDITOR.dialog.validate.integer()(j)&&j>0;if(!i){alert(f.lang.table.invalidCols);this.select();}return i;},setup:function(i){this.setValue(a(i));},commit:b},{type:"select",id:"selHeaders","default":"",label:f.lang.table.headers,items:[[f.lang.table.headersNone,""],[f.lang.table.headersRow,"row"],[f.lang.table.headersColumn,"col"],[f.lang.table.headersBoth,"both"]],setup:function(j){var k=this.getDialog();k.hasColumnHeaders=true;for(var l=0;l<j.$.rows.length;l++){var i=j.$.rows[l].cells[0];if(i&&i.nodeName.toLowerCase()!="th"){k.hasColumnHeaders=false;break;}}if((j.$.tHead!==null)){this.setValue(k.hasColumnHeaders?"both":"row");}else{this.setValue(k.hasColumnHeaders?"col":"");}},commit:b},{id:"cmbAlign",type:"select","default":"",label:f.lang.common.align,items:[[f.lang.common.notSet,""],[f.lang.common.alignLeft,"left"],[f.lang.common.alignCenter,"center"],[f.lang.common.alignRight,"right"]],setup:function(i){this.setValue(i.getAttribute("align")||"");},commit:function(j,i){if(this.getValue()){i.setAttribute("align",this.getValue());}else{i.removeAttribute("align");}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",controlStyle:"width:5em",label:f.lang.common.width,title:f.lang.common.cssLengthTooltip,"default":500,getValue:c,validate:CKEDITOR.dialog.validate.cssLength(f.lang.common.invalidCssLength.replace("%1",f.lang.common.width)),onChange:function(){var i=this.getDialog().getContentElement("advanced","advStyles");i&&i.updateStyle("width",this.getValue());},setup:function(i){var j=i.getStyle("width");j&&this.setValue(j);},commit:b}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",controlStyle:"width:5em",label:f.lang.common.height,title:f.lang.common.cssLengthTooltip,"default":"",getValue:c,validate:CKEDITOR.dialog.validate.cssLength(f.lang.common.invalidCssLength.replace("%1",f.lang.common.height)),onChange:function(){var i=this.getDialog().getContentElement("advanced","advStyles");i&&i.updateStyle("height",this.getValue());},setup:function(i){var j=i.getStyle("height");j&&this.setValue(j);},commit:b}]}]}]}]}]};}CKEDITOR.dialog.add("grid",function(e){return d(e,"grid");});CKEDITOR.dialog.add("gridProperties",function(e){return d(e,"gridProperties");});})();
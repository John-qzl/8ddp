CKEDITOR.htmlParser.fragment=function(){this.children=[];this.parent=null;this._={isBlockLike:true,hasInlineStarted:false};};(function(){var d=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl);var a=CKEDITOR.env.ie&&CKEDITOR.env.version<8?{dd:1,dt:1}:{};var e={ol:1,ul:1};var b=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1});function c(f){return f.name=="a"&&f.attributes.href||CKEDITOR.dtd.$removeEmpty[f.name];}CKEDITOR.htmlParser.fragment.fromHtml=function(l,r,m){var f=new CKEDITOR.htmlParser(),o=m||new CKEDITOR.htmlParser.fragment(),p=[],q=[],g=o,j=false,n=false;function i(y){var u;if(p.length>0){for(var v=0;v<p.length;v++){var t=p[v],w=t.name,x=CKEDITOR.dtd[w],s=g.name&&CKEDITOR.dtd[g.name];if((!s||s[w])&&(!y||!x||x[y]||!CKEDITOR.dtd[y])){if(!u){k();u=1;}t=t.clone();t.parent=g;g=t;p.splice(v,1);v--;}else{if(w==g.name){h(g,g.parent,1),v--;}}}}}function k(){while(q.length){g.add(q.shift());}}function h(w,x,u){if(w.previous!==undefined){return;}x=x||g||o;var z=g;if(r&&(!x.type||x.name=="body")){var A,v;if(w.attributes&&(v=w.attributes["data-cke-real-element-type"])){A=v;}else{A=w.name;}if(A&&!(A in CKEDITOR.dtd.$body||A=="body"||w.isOrphan)){g=x;f.onTagOpen(r,{});w.returnPoint=x=g;}}if(w._.isBlockLike&&w.name!="pre"&&w.name!="textarea"){var t=w.children.length,s=w.children[t-1],y;if(s&&s.type==CKEDITOR.NODE_TEXT){if(!(y=CKEDITOR.tools.rtrim(s.value))){w.children.length=t-1;}else{s.value=y;}}}x.add(w);if(w.returnPoint){g=w.returnPoint;delete w.returnPoint;}else{g=u?x:z;}}f.onTagOpen=function(u,v,x,y){var w=new CKEDITOR.htmlParser.element(u,v);if(w.isUnknown&&x){w.isEmpty=true;}w.isOptionalClose=u in a||y;if(c(w)){p.push(w);return;}else{if(u=="pre"){n=true;}else{if(u=="br"&&n){g.add(new CKEDITOR.htmlParser.text("\n"));return;}else{if(u=="textarea"){j=true;}}}}if(u=="br"){q.push(w);return;}while(1){var A=g.name;var z=A?(CKEDITOR.dtd[A]||(g._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span)):b;if(!w.isUnknown&&!g.isUnknown&&!z[u]){if(g.isOptionalClose){f.onTagClose(A);}else{if(u in e&&A in e){var t=g.children,s=t[t.length-1];if(!(s&&s.name=="li")){h((s=new CKEDITOR.htmlParser.element("li")),g);}!w.returnPoint&&(w.returnPoint=g);g=s;}else{if(u in CKEDITOR.dtd.$listItem&&A!=u){f.onTagOpen(u=="li"?"ul":"dl",{},0,1);}else{if(A in d&&A!=u){!w.returnPoint&&(w.returnPoint=g);g=g.parent;}else{if(A in CKEDITOR.dtd.$inline){p.unshift(g);}if(g.parent){h(g,g.parent,1);}else{w.isOrphan=1;break;}}}}}}else{break;}}i(u);k();w.parent=g;if(w.isEmpty){h(w);}else{g=w;}};f.onTagClose=function(u){for(var t=p.length-1;t>=0;t--){if(u==p[t].name){p.splice(t,1);return;}}var x=[],s=[],v=g;while(v!=o&&v.name!=u){if(!v._.isBlockLike){s.unshift(v);}x.push(v);v=v.returnPoint||v.parent;}if(v!=o){for(t=0;t<x.length;t++){var w=x[t];h(w,w.parent);}g=v;if(g.name=="pre"){n=false;}if(g.name=="textarea"){j=false;}if(v._.isBlockLike){k();}h(v,v.parent);if(v==g){g=g.parent;}p=p.concat(s);}if(u=="body"){r=false;}};f.onText=function(s){if((!g._.hasInlineStarted||q.length)&&!n&&!j){s=CKEDITOR.tools.ltrim(s);if(s.length===0){return;}}k();i();if(r&&(!g.type||g.name=="body")&&CKEDITOR.tools.trim(s)){this.onTagOpen(r,{},0,1);}if(!n&&!j){s=s.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ");}g.add(new CKEDITOR.htmlParser.text(s));};f.onCDATA=function(s){g.add(new CKEDITOR.htmlParser.cdata(s));};f.onComment=function(s){k();i();g.add(new CKEDITOR.htmlParser.comment(s));};f.parse(l);k(!CKEDITOR.env.ie&&1);while(g!=o){h(g,g.parent,1);}return o;};CKEDITOR.htmlParser.fragment.prototype={add:function(h,f){isNaN(f)&&(f=this.children.length);var g=f>0?this.children[f-1]:null;if(g){if(h._.isBlockLike&&g.type==CKEDITOR.NODE_TEXT){g.value=CKEDITOR.tools.rtrim(g.value);if(g.value.length===0){this.children.pop();this.add(h);return;}}g.next=h;}h.previous=g;h.parent=this;this.children.splice(f,0,h);this._.hasInlineStarted=h.type==CKEDITOR.NODE_TEXT||(h.type==CKEDITOR.NODE_ELEMENT&&!h._.isBlockLike);},writeHtml:function(h,f){var g;this.filterChildren=function(){var j=new CKEDITOR.htmlParser.basicWriter();this.writeChildrenHtml.call(this,j,f,true);var i=j.getHtml();this.children=new CKEDITOR.htmlParser.fragment.fromHtml(i).children;g=1;};!this.name&&f&&f.onFragment(this);this.writeChildrenHtml(h,g?null:f);},writeChildrenHtml:function(h,g){for(var f=0;f<this.children.length;f++){this.children[f].writeHtml(h,g);}}};})();
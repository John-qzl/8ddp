var XMLParser=Editor.Parser=(function(){var e={autoSelfClosers:{"br":true,"img":true,"hr":true,"link":true,"input":true,"meta":true,"col":true,"frame":true,"base":true,"area":true},doNotIndent:{"pre":true,"!cdata":true}};var f={autoSelfClosers:{},doNotIndent:{"!cdata":true}};var d=e;var c=false;var b=(function(){function g(l,m){var k=l.next();if(k=="<"){if(l.equals("!")){l.next();if(l.equals("[")){if(l.lookAhead("[CDATA[",true)){m(h("xml-cdata","]]>"));return null;}else{return"xml-text";}}else{if(l.lookAhead("--",true)){m(h("xml-comment","-->"));return null;}else{if(l.lookAhead("DOCTYPE",true)){l.nextWhileMatches(/[\w\._\-]/);m(h("xml-doctype",">"));return"xml-doctype";}else{return"xml-text";}}}}else{if(l.equals("?")){l.next();l.nextWhileMatches(/[\w\._\-]/);m(h("xml-processing","?>"));return"xml-processing";}else{if(l.equals("/")){l.next();}m(j);return"xml-punctuation";}}}else{if(k=="&"){while(!l.endOfLine()){if(l.next()==";"){break;}}return"xml-entity";}else{l.nextWhileMatches(/[^&<\n]/);return"xml-text";}}}function j(l,m){var k=l.next();if(k==">"){m(g);return"xml-punctuation";}else{if(/[?\/]/.test(k)&&l.equals(">")){l.next();m(g);return"xml-punctuation";}else{if(k=="="){return"xml-punctuation";}else{if(/[\'\"]/.test(k)){m(i(k));return null;}else{l.nextWhileMatches(/[^\s\u00a0=<>\"\'\/?]/);return"xml-name";}}}}}function i(k){return function(l,m){while(!l.endOfLine()){if(l.next()==k){m(j);break;}}return"xml-attribute";};}function h(l,k){return function(m,n){while(!m.endOfLine()){if(m.lookAhead(k,true)){n(g);break;}m.next();}return l;};}return function(l,k){return tokenizer(l,k||g);};})();function a(C){var y=b(C),t;var z=[q];var p=0,B=0;var A=null,n=null;var w;function s(G){for(var H=G.length-1;H>=0;H--){z.push(G[H]);}}function l(){s(arguments);w=true;}function g(){s(arguments);w=false;}function m(){t.style+=" xml-error";}function o(G){return function(H,I){if(I==G){l();}else{m();l(arguments.callee);}};}function r(H,I){var G=d.doNotIndent.hasOwnProperty(H)||(n&&n.noIndent);n={prev:n,name:H,indent:B,startOfLine:I,noIndent:G};}function E(){n=n.prev;}function h(G){return function(H,J){var I=G;if(I&&I.noIndent){return J;}if(c&&/<!\[CDATA\[/.test(H)){return 0;}if(I&&/^<\//.test(H)){I=I.prev;}while(I&&!I.startOfLine){I=I.prev;}if(I){return I.indent+indentUnit;}else{return 0;}};}function q(){return g(j,q);}var k={"xml-text":true,"xml-entity":true,"xml-comment":true,"xml-processing":true,"xml-doctype":true};function j(G,H){if(H=="<"){l(F,v,i(p==1));}else{if(H=="</"){l(u,o(">"));}else{if(G=="xml-cdata"){if(!n||n.name!="!cdata"){r("!cdata");}if(/\]\]>$/.test(H)){E();}l();}else{if(k.hasOwnProperty(G)){l();}else{m();l();}}}}}function F(G,H){if(G=="xml-name"){A=H.toLowerCase();t.style="xml-tagname";l();}else{A=null;g();}}function u(G,H){if(G=="xml-name"){t.style="xml-tagname";if(n&&H.toLowerCase()==n.name){E();}else{m();}}l();}function i(G){return function(H,I){if(I=="/>"||(I==">"&&d.autoSelfClosers.hasOwnProperty(A))){l();}else{if(I==">"){r(A,G);l();}else{m();l(arguments.callee);}}};}function v(G){if(G=="xml-name"){t.style="xml-attname";l(x,v);}else{g();}}function x(G,H){if(H=="="){l(D);}else{if(H==">"||H=="/>"){g(i);}else{g();}}}function D(G){if(G=="xml-attribute"){l(D);}else{g();}}return{indentation:function(){return B;},next:function(){t=y.next();if(t.style=="whitespace"&&p==0){B=t.value.length;}else{p++;}if(t.content=="\n"){B=p=0;t.indentation=h(n);}if(t.style=="whitespace"||t.type=="xml-comment"){return t;}while(true){w=false;z.pop()(t.style,t.content);if(w){return t;}}},copy:function(){var I=z.concat([]),H=y.state,G=n;var J=this;return function(K){z=I.concat([]);p=B=0;n=G;y=b(K,H);return J;};}};}return{make:a,electricChars:"/",configure:function(g){if(g.useHTMLKludges!=null){d=g.useHTMLKludges?e:f;}if(g.alignCDATA){c=g.alignCDATA;}}};})();
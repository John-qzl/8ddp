var internetExplorer=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);var webkit=/AppleWebKit/.test(navigator.userAgent);var safari=/Apple Computer, Inc/.test(navigator.vendor);var gecko=navigator.userAgent.match(/gecko\/(\d{8})/i);if(gecko){gecko=Number(gecko[1]);}var mac=/Mac/.test(navigator.platform);var brokenOpera=window.opera&&/Version\/10.[56]/.test(navigator.userAgent);var slowWebkit=/AppleWebKit\/533/.test(navigator.userAgent);function makeWhiteSpace(c){var b=[],a=true;for(;c>0;c--){b.push((a||c==1)?nbsp:" ");a^=true;}return b.join("");}function fixSpaces(a){if(a.charAt(0)==" "){a=nbsp+a.slice(1);}return a.replace(/\t/g,function(){return makeWhiteSpace(indentUnit);}).replace(/[ \u00a0]{2,}/g,function(b){return makeWhiteSpace(b.length);});}function cleanText(a){return a.replace(/\u00a0/g," ").replace(/\u200b/g,"");}function makePartSpan(b){var c=b;if(b.nodeType==3){c=b.nodeValue;}else{b=document.createTextNode(c);}var a=document.createElement("span");a.isPart=true;a.appendChild(b);a.currentText=c;return a;}function alwaysZero(){return 0;}var webkitLastLineHack=webkit?function(a){var c=a.lastChild;if(!c||!c.hackBR){var b=document.createElement("br");b.hackBR=true;a.appendChild(b);}}:function(){};function asEditorLines(a){var b=makeWhiteSpace(indentUnit);return map(a.replace(/\t/g,b).replace(/\u00a0/g," ").replace(/\r\n?/g,"\n").split("\n"),fixSpaces);}var Editor=(function(){var f={"P":true,"DIV":true,"LI":true};function c(m,l){var k=[];var o=true;function n(p,q){if(p.nodeType==3){var r=p.nodeValue=fixSpaces(p.nodeValue.replace(/[\r\u200b]/g,"").replace(/\n/g," "));if(r.length){o=false;}k.push(p);}else{if(isBR(p)&&p.childNodes.length==0){o=true;k.push(p);}else{for(var s=p.firstChild;s;s=s.nextSibling){n(s);}if(!o&&f.hasOwnProperty(p.nodeName.toUpperCase())){o=true;if(!l||!q){k.push(document.createElement("br"));}}}}}n(m,true);return k;}function d(k){var l=[];function p(v){var u=v.parentNode;var t=v.nextSibling;return function(w){u.insertBefore(w,t);};}var r=null;var q=true;function m(t){var u="\n";if(t.nodeType==3){select.snapshotChanged();t=makePartSpan(t);u=t.currentText;q=false;}else{if(q&&window.opera){r(makePartSpan(""));}q=true;}t.dirty=true;l.push(t);r(t);return u;}function n(v,t){var w=c(v,t);for(var u=0;u<w.length;u++){w[u]=m(w[u]);}return w.join("");}function s(t){if(t.isPart&&t.childNodes.length==1&&t.firstChild.nodeType==3){var u=t.firstChild.nodeValue;t.dirty=t.dirty||u!=t.currentText;t.currentText=u;return !/[\n\t\r]/.test(t.currentText);}return false;}function o(){if(!k){throw StopIteration;}var u=k;k=u.nextSibling;if(s(u)){l.push(u);q=false;return u.currentText;}else{if(isBR(u)){if(q&&window.opera){u.parentNode.insertBefore(makePartSpan(""),u);}l.push(u);q=true;return"\n";}else{var t=!u.nextSibling;r=p(u);removeElement(u);return n(u,t);}}}return{next:o,nodes:l};}function g(k){return isBR(k)?1:k.currentText.length;}function h(k){while(k&&!isBR(k)){k=k.previousSibling;}return k;}function j(l,k){if(!l){l=k.firstChild;}else{if(isBR(l)){l=l.nextSibling;}}while(l&&!isBR(l)){l=l.nextSibling;}return l;}function b(){return new Date().getTime();}function i(m,o,q,k){this.editor=m;this.history=m.history;this.history.commit();this.valid=!!o;this.atOccurrence=false;if(k==undefined){k=typeof o=="string"&&o==o.toLowerCase();}function r(u){var t=cleanText(m.history.textAfter(u));return(k?t.toLowerCase():t);}var l={node:null,offset:0},s=this;if(q&&typeof q=="object"&&typeof q.character=="number"){m.checkLine(q.line);var p={node:q.line,offset:q.character};this.pos={from:p,to:p};}else{if(q){this.pos={from:select.cursorPos(m.container,true)||l,to:select.cursorPos(m.container,false)||l};}else{this.pos={from:l,to:l};}}if(typeof o!="string"){this.matches=function(v,w,z){if(v){var t=r(w).slice(0,z),u=t.match(o),A=0;while(u){var x=t.indexOf(u[0]);A+=x;t=t.slice(x+1);var y=t.match(o);if(y){u=y;}else{break;}}}else{var t=r(w).slice(z),u=t.match(o),A=u&&z+t.indexOf(u[0]);}if(u){s.currentMatch=u;return{from:{node:w,offset:A},to:{node:w,offset:A+u[0].length}};}};return;}if(k){o=o.toLowerCase();}var n=o.split("\n");this.matches=(n.length==1)?function(w,x,y){var u=r(x),t=o.length,v;if(w?(y>=t&&(v=u.lastIndexOf(o,y-t))!=-1):(v=u.indexOf(o,y))!=-1){return{from:{node:x,offset:v},to:{node:x,offset:v+t}};}}:function(y,t,u){var A=(y?n.length-1:0),w=n[A],B=r(t);var x=(y?B.indexOf(w)+w.length:B.lastIndexOf(w));if(y?x>=u||x!=w.length:x<=u||x!=B.length-w.length){return;}var z=t;while(true){if(y&&!z){return;}z=(y?this.history.nodeBefore(z):this.history.nodeAfter(z));if(!y&&!z){return;}B=r(z);w=n[y?--A:++A];if(A>0&&A<n.length-1){if(B!=w){return;}else{continue;}}var v=(y?B.lastIndexOf(w):B.indexOf(w)+w.length);if(y?v!=B.length-w.length:v!=w.length){return;}return{from:{node:y?z:t,offset:y?v:x},to:{node:y?t:z,offset:y?x:v}};}};}i.prototype={findNext:function(){return this.find(false);},findPrevious:function(){return this.find(true);},find:function(l){if(!this.valid){return false;}var k=this,q=l?this.pos.from:this.pos.to,o=q.node,p=q.offset;if(o&&!o.parentNode){o=null;p=0;}function n(){var r={node:o,offset:p};k.pos={from:r,to:r};k.atOccurrence=false;return false;}while(true){if(this.pos=this.matches(l,o,p)){this.atOccurrence=true;return true;}if(l){if(!o){return n();}o=this.history.nodeBefore(o);p=this.history.textAfter(o).length;}else{var m=this.history.nodeAfter(o);if(!m){p=this.history.textAfter(o).length;return n();}o=m;p=0;}}},select:function(){if(this.atOccurrence){select.setCursorPos(this.editor.container,this.pos.from,this.pos.to);select.scrollToCursor(this.editor.container);}},replace:function(m){if(this.atOccurrence){var k=this.currentMatch;if(k){m=m.replace(/\\(\d)/,function(n,o){return k[o];});}var l=this.editor.replaceRange(this.pos.from,this.pos.to,m);this.pos.to=l;this.atOccurrence=false;}},position:function(){if(this.atOccurrence){return{line:this.pos.from.node,character:this.pos.from.offset};}}};function e(n){this.options=n;window.indentUnit=n.indentUnit;var k=this.container=document.body;this.history=new UndoHistory(k,n.undoDepth,n.undoDelay,this);var m=this;if(!e.Parser){throw"No parser loaded.";}if(n.parserConfig&&e.Parser.configure){e.Parser.configure(n.parserConfig);}if(!n.readOnly&&!internetExplorer){select.setCursorPos(k,{node:null,offset:0});}this.dirty=[];this.importCode(n.content||"");this.history.onChange=n.onChange;if(!n.readOnly){if(n.continuousScanning!==false){this.scanner=this.documentScanner(n.passTime);this.delayScanning();}function o(){if(document.body.contentEditable!=undefined&&internetExplorer){document.body.contentEditable="true";}else{document.designMode="on";}if(internetExplorer&&n.height!="dynamic"){document.body.style.minHeight=(window.frameElement.clientHeight-2*document.body.offsetTop-5)+"px";}document.documentElement.style.borderWidth="0";if(!n.textWrapping){k.style.whiteSpace="nowrap";}}try{o();}catch(q){var l=addEventHandler(document,"focus",function(){l();o();},true);}addEventHandler(document,"keydown",method(this,"keyDown"));addEventHandler(document,"keypress",method(this,"keyPress"));addEventHandler(document,"keyup",method(this,"keyUp"));function p(){m.cursorActivity(false);}addEventHandler(internetExplorer?document.body:window,"mouseup",p);addEventHandler(document.body,"cut",p);if(gecko){addEventHandler(window,"pagehide",function(){m.unloaded=true;});}addEventHandler(document.body,"paste",function(r){p();var t=null;try{var u=r.clipboardData||window.clipboardData;if(u){t=u.getData("Text");}}catch(s){}if(t!==null){r.stop();m.replaceSelection(t);select.scrollToCursor(m.container);}});if(this.options.autoMatchParens){addEventHandler(document.body,"click",method(this,"scheduleParenHighlight"));}}else{if(!n.textWrapping){k.style.whiteSpace="nowrap";}}}function a(k){return(k>=16&&k<=18)||(k>=33&&k<=40);}e.prototype={importCode:function(o){var k=asEditorLines(o),n=1000;if(!this.options.incrementalLoading||k.length<n){this.history.push(null,null,k);this.history.reset();}else{var p=0,l=this;function m(){var q=k.slice(p,p+n);q.push("");l.history.push(l.history.nodeBefore(null),null,q);l.history.reset();p+=n;if(p<k.length){parent.setTimeout(m,1000);}}m();}},getCode:function(){if(!this.container.firstChild){return"";}var k=[];select.markSelection();forEach(d(this.container.firstChild),method(k,"push"));select.selectMarked();if(webkit&&this.container.lastChild.hackBR){k.pop();}webkitLastLineHack(this.container);return cleanText(k.join(""));},checkLine:function(k){if(k===false||!(k==null||k.parentNode==this.container||k.hackBR)){throw parent.CodeMirror.InvalidLineHandle;}},cursorPosition:function(l){if(l==null){l=true;}var k=select.cursorPos(this.container,l);if(k){return{line:k.node,character:k.offset};}else{return{line:null,character:0};}},firstLine:function(){return null;},lastLine:function(){var k=this.container.lastChild;if(k){k=h(k);}if(k&&k.hackBR){k=h(k.previousSibling);}return k;},nextLine:function(l){this.checkLine(l);var k=j(l,this.container);if(!k||k.hackBR){return false;}else{return k;}},prevLine:function(k){this.checkLine(k);if(k==null){return false;}return h(k.previousSibling);},visibleLineCount:function(){var k=this.container.firstChild;while(k&&isBR(k)){k=k.nextSibling;}if(!k){return false;}var l=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight);return Math.floor(l/k.offsetHeight);},selectLines:function(o,k,n,m){this.checkLine(o);var p={node:o,offset:k},l=null;if(m!==undefined){this.checkLine(n);l={node:n,offset:m};}select.setCursorPos(this.container,p,l);select.scrollToCursor(this.container);},lineContent:function(k){var l=[];for(k=k?k.nextSibling:this.container.firstChild;k&&!isBR(k);k=k.nextSibling){l.push(nodeText(k));}return cleanText(l.join(""));},setLineContent:function(k,l){this.history.commit();this.replaceRange({node:k,offset:0},{node:k,offset:this.history.textAfter(k).length},l);this.addDirtyNode(k);this.scheduleHighlight();},removeLine:function(k){var m=k?k.nextSibling:this.container.firstChild;while(m){var l=m.nextSibling;removeElement(m);if(isBR(m)){break;}m=l;}this.addDirtyNode(k);this.scheduleHighlight();},insertIntoLine:function(m,k,o){var p=null;if(k=="end"){p=j(m,this.container);}else{for(var r=m?m.nextSibling:this.container.firstChild;r;r=r.nextSibling){if(k==0){p=r;break;}var q=nodeText(r);if(q.length>k){p=r.nextSibling;o=q.slice(0,k)+o+q.slice(k);removeElement(r);break;}k-=q.length;}}var l=asEditorLines(o);for(var n=0;n<l.length;n++){if(n>0){this.container.insertBefore(document.createElement("BR"),p);}this.container.insertBefore(makePartSpan(l[n]),p);}this.addDirtyNode(m);this.scheduleHighlight();},selectedText:function(){var l=this.history;l.commit();var o=select.cursorPos(this.container,true),k=select.cursorPos(this.container,false);if(!o||!k){return"";}if(o.node==k.node){return l.textAfter(o.node).slice(o.offset,k.offset);}var m=[l.textAfter(o.node).slice(o.offset)];for(var n=l.nodeAfter(o.node);n!=k.node;n=l.nodeAfter(n)){m.push(l.textAfter(n));}m.push(l.textAfter(k.node).slice(0,k.offset));return cleanText(m.join("\n"));},replaceSelection:function(l){this.history.commit();var m=select.cursorPos(this.container,true),k=select.cursorPos(this.container,false);if(!m||!k){return;}k=this.replaceRange(m,k,l);select.setCursorPos(this.container,k);webkitLastLineHack(this.container);},cursorCoords:function(k,p){var l=select.cursorPos(this.container,k);if(!l){return null;}var m=l.offset,n=l.node,s=this;function r(v,u){var w=-(document.body.scrollTop||document.documentElement.scrollTop||0),t=-(document.body.scrollLeft||document.documentElement.scrollLeft||0)+u;forEach([v,p?null:window.frameElement],function(x){while(x){t+=x.offsetLeft;w+=x.offsetTop;x=x.offsetParent;}});return{x:t,y:w,yBot:w+v.offsetHeight};}function q(v,u){var t=document.createElement("SPAN");t.appendChild(document.createTextNode(v));try{return u(t);}finally{if(t.parentNode){t.parentNode.removeChild(t);}}}while(m){n=n?n.nextSibling:this.container.firstChild;var o=nodeText(n);if(m<o.length){return q(o.substr(0,m),function(t){t.style.position="absolute";t.style.visibility="hidden";t.className=n.className;s.container.appendChild(t);return r(n,t.offsetWidth);});}m-=o.length;}if(n&&isSpan(n)){return r(n,n.offsetWidth);}else{if(n&&n.nextSibling&&isSpan(n.nextSibling)){return r(n.nextSibling,0);}else{return q("\u200b",function(t){if(n){n.parentNode.insertBefore(t,n.nextSibling);}else{s.container.insertBefore(t,s.container.firstChild);}return r(t,0);});}}},reroutePasteEvent:function(){if(this.capturingPaste||window.opera||(gecko&&gecko>=20101026)){return;}this.capturingPaste=true;var n=window.frameElement.CodeMirror.textareaHack;var m=this.cursorCoords(true,true);n.style.top=m.y+"px";if(internetExplorer){var l=select.getBookmark(this.container);if(l){this.selectionSnapshot=l;}}parent.focus();n.value="";n.focus();var k=this;parent.setTimeout(function(){k.capturingPaste=false;window.focus();if(k.selectionSnapshot){window.select.setBookmark(k.container,k.selectionSnapshot);}var o=n.value;if(o){k.replaceSelection(o);select.scrollToCursor(k.container);}},10);},replaceRange:function(p,o,n){var m=asEditorLines(n);m[0]=this.history.textAfter(p.node).slice(0,p.offset)+m[0];var l=m[m.length-1];m[m.length-1]=l+this.history.textAfter(o.node).slice(o.offset);var k=this.history.nodeAfter(o.node);this.history.push(p.node,k,m);return{node:this.history.nodeBefore(k),offset:l.length};},getSearchCursor:function(l,k,m){return new i(this,l,k,m);},reindent:function(){if(this.container.firstChild){this.indentRegion(null,this.container.lastChild);}},reindentSelection:function(l){if(!select.somethingSelected()){this.indentAtCursor(l);}else{var m=select.selectionTopNode(this.container,true),k=select.selectionTopNode(this.container,false);if(m===false||k===false){return;}this.indentRegion(m,k,l);}},grabKeys:function(k,l){this.frozen=k;this.keyFilter=l;},ungrabKeys:function(){this.frozen="leave";},setParser:function(k,l){e.Parser=window[k];l=l||this.options.parserConfig;if(l&&e.Parser.configure){e.Parser.configure(l);}if(this.container.firstChild){forEach(this.container.childNodes,function(m){if(m.nodeType!=3){m.dirty=true;}});this.addDirtyNode(this.firstChild);this.scheduleHighlight();}},keyDown:function(m){if(this.frozen=="leave"){this.frozen=null;this.keyFilter=null;}if(this.frozen&&(!this.keyFilter||this.keyFilter(m.keyCode,m))){m.stop();this.frozen(m);return;}var l=m.keyCode;this.delayScanning();if(this.options.autoMatchParens){this.scheduleParenHighlight();}if(l==13){if(m.ctrlKey&&!m.altKey){this.reparseBuffer();}else{select.insertNewlineAtCursor();var o=this.options.enterMode;if(o!="flat"){this.indentAtCursor(o=="keep"?"keep":undefined);}select.scrollToCursor(this.container);}m.stop();}else{if(l==9&&this.options.tabMode!="default"&&!m.ctrlKey){this.handleTab(!m.shiftKey);m.stop();}else{if(l==32&&m.shiftKey&&this.options.tabMode=="default"){this.handleTab(true);m.stop();}else{if(l==36&&!m.shiftKey&&!m.ctrlKey){if(this.home()){m.stop();}}else{if(l==35&&!m.shiftKey&&!m.ctrlKey){if(this.end()){m.stop();}}else{if(l==33&&!m.shiftKey&&!m.ctrlKey&&!gecko){if(this.pageUp()){m.stop();}}else{if(l==34&&!m.shiftKey&&!m.ctrlKey&&!gecko){if(this.pageDown()){m.stop();}}else{if((l==219||l==221)&&m.ctrlKey&&!m.altKey){this.highlightParens(m.shiftKey,true);m.stop();}else{if(m.metaKey&&!m.shiftKey&&(l==37||l==39)){var n=select.selectionTopNode(this.container);if(n===false||!this.container.firstChild){return;}if(l==37){select.focusAfterNode(h(n),this.container);}else{var k=j(n,this.container);select.focusAfterNode(k?k.previousSibling:this.container.lastChild,this.container);}m.stop();}else{if((m.ctrlKey||m.metaKey)&&!m.altKey){if((m.shiftKey&&l==90)||l==89){select.scrollToNode(this.history.redo());m.stop();}else{if(l==90||(safari&&l==8)){select.scrollToNode(this.history.undo());m.stop();}else{if(l==83&&this.options.saveFunction){this.options.saveFunction();m.stop();}else{if(l==86&&!mac){this.reroutePasteEvent();}}}}}}}}}}}}}}},keyPress:function(n){var k=this.options.electricChars&&e.Parser.electricChars,l=this;if((this.frozen&&(!this.keyFilter||this.keyFilter(n.keyCode||n.code,n)))||n.code==13||(n.code==9&&this.options.tabMode!="default")||(n.code==32&&n.shiftKey&&this.options.tabMode=="default")){n.stop();}else{if(mac&&(n.ctrlKey||n.metaKey)&&n.character=="v"){this.reroutePasteEvent();}else{if(k&&k.indexOf(n.character)!=-1){parent.setTimeout(function(){l.indentAtCursor(null);},0);}else{if(brokenOpera){if(n.code==8){var o=select.selectionTopNode(this.container),l=this,m=o?o.nextSibling:this.container.firstChild;if(o!==false&&m&&isBR(m)){parent.setTimeout(function(){if(select.selectionTopNode(l.container)==m){select.focusAfterNode(m.previousSibling,l.container);}},20);}}else{if(n.code==46){var o=select.selectionTopNode(this.container),l=this;if(o&&isBR(o)){parent.setTimeout(function(){if(select.selectionTopNode(l.container)!=o){select.focusAfterNode(o,l.container);}},20);}}}}else{if(slowWebkit){var o=select.selectionTopNode(this.container),m=o?o.nextSibling:this.container.firstChild;if(o&&m&&isBR(m)&&!isBR(o)){var p=document.createTextNode("\u200b");this.container.insertBefore(p,m);parent.setTimeout(function(){if(p.nodeValue=="\u200b"){removeElement(p);}else{p.nodeValue=p.nodeValue.replace("\u200b","");}},20);}}}}}}if(webkit&&!this.options.textWrapping){setTimeout(function(){var q=select.selectionTopNode(l.container,true);if(q&&q.nodeType==3&&q.previousSibling&&isBR(q.previousSibling)&&q.nextSibling&&isBR(q.nextSibling)){q.parentNode.replaceChild(document.createElement("BR"),q.previousSibling);}},50);}},keyUp:function(k){this.cursorActivity(a(k.keyCode));},indentLineAfter:function(k,p){function t(w){var v=w?w.nextSibling:u.container.firstChild;if(!v||!hasClass(v,"whitespace")){return null;}return v;}var u=this,r=t(k);var l=0,s=r?r.currentText.length:0;var o=r?r.nextSibling:(k?k.nextSibling:this.container.firstChild);if(p=="keep"){if(k){var q=t(h(k.previousSibling));if(q){l=q.currentText.length;}}}else{var n=(k&&o&&o.currentText)?o.currentText:"";if(p!=null&&this.options.tabMode=="shift"){l=p?s+indentUnit:Math.max(0,s-indentUnit);}else{if(k){l=k.indentation(n,s,p,o);}else{if(e.Parser.firstIndentation){l=e.Parser.firstIndentation(n,s,p,o);}}}}var m=l-s;if(m<0){if(l==0){if(o){select.snapshotMove(r.firstChild,o.firstChild||o,0);}removeElement(r);r=null;}else{select.snapshotMove(r.firstChild,r.firstChild,m,true);r.currentText=makeWhiteSpace(l);r.firstChild.nodeValue=r.currentText;}}else{if(m>0){if(r){r.currentText=makeWhiteSpace(l);r.firstChild.nodeValue=r.currentText;select.snapshotMove(r.firstChild,r.firstChild,m,true);}else{r=makePartSpan(makeWhiteSpace(l));r.className="whitespace";if(k){insertAfter(r,k);}else{this.container.insertBefore(r,this.container.firstChild);}select.snapshotMove(o&&(o.firstChild||o),r.firstChild,l,false,true);}}else{if(r){select.snapshotMove(r.firstChild,r.firstChild,l,false);}}}if(m!=0){this.addDirtyNode(k);}},highlightAtCursor:function(){var l=select.selectionTopNode(this.container,true);var k=select.selectionTopNode(this.container,false);if(l===false||k===false){return false;}select.markSelection();if(this.highlight(l,j(k,this.container),true,20)===false){return false;}select.selectMarked();return true;},handleTab:function(k){if(this.options.tabMode=="spaces"){select.insertTabAtCursor();}else{this.reindentSelection(k);}},home:function(){var l=select.selectionTopNode(this.container,true),m=l;if(l===false||!(!l||l.isPart||isBR(l))||!this.container.firstChild){return false;}while(l&&!isBR(l)){l=l.previousSibling;}var k=l?l.nextSibling:this.container.firstChild;if(k&&k!=m&&k.isPart&&hasClass(k,"whitespace")){select.focusAfterNode(k,this.container);}else{select.focusAfterNode(l,this.container);}select.scrollToCursor(this.container);return true;},end:function(){var k=select.selectionTopNode(this.container,true);if(k===false){return false;}k=j(k,this.container);if(!k){return false;}select.focusAfterNode(k.previousSibling,this.container);select.scrollToCursor(this.container);return true;},pageUp:function(){var k=this.cursorPosition().line,m=this.visibleLineCount();if(k===false||m===false){return false;}m-=2;for(var l=0;l<m;l++){k=this.prevLine(k);if(k===false){break;}}if(l==0){return false;}select.setCursorPos(this.container,{node:k,offset:0});select.scrollToCursor(this.container);return true;},pageDown:function(){var k=this.cursorPosition().line,n=this.visibleLineCount();if(k===false||n===false){return false;}n-=2;for(var l=0;l<n;l++){var m=this.nextLine(k);if(m===false){break;}k=m;}if(l==0){return false;}select.setCursorPos(this.container,{node:k,offset:0});select.scrollToCursor(this.container);return true;},scheduleParenHighlight:function(){if(this.parenEvent){parent.clearTimeout(this.parenEvent);}var k=this;this.parenEvent=parent.setTimeout(function(){k.highlightParens();},300);},highlightParens:function(y,l){var w=this,o=this.options.markParen;if(typeof o=="string"){o=[o,o];}function n(A,z){if(!A){return;}if(!o){A.style.fontWeight="bold";A.style.color=z?"#8F8":"#F88";}else{if(o.call){o(A,z);}else{A.className+=" "+o[z?0:1];}}}function t(z){if(!z){return;}if(o&&!o.call){removeClass(removeClass(z,o[0]),o[1]);}else{if(w.options.unmarkParen){w.options.unmarkParen(z);}else{z.style.fontWeight="";z.style.color="";}}}if(!l&&w.highlighted){t(w.highlighted[0]);t(w.highlighted[1]);}if(!window||!window.parent||!window.select){return;}if(this.parenEvent){parent.clearTimeout(this.parenEvent);}this.parenEvent=null;function u(A){if(A.currentText){var z=A.currentText.match(/^[\s\u00a0]*([\(\)\[\]{}])[\s\u00a0]*$/);return z&&z[1];}}function q(z){return/[\(\[\{]/.test(z);}var k,v=select.selectionTopNode(this.container,true);if(!v||!this.highlightAtCursor()){return;}v=select.selectionTopNode(this.container,true);if(!(v&&((k=u(v))||(v=v.nextSibling)&&(k=u(v))))){return;}var s=v.className,m=q(k),p=matching[k];function r(){var z=[],B,A=true;for(var C=v;C;C=m?C.nextSibling:C.previousSibling){if(C.className==s&&isSpan(C)&&(B=u(C))){if(q(B)==m){z.push(B);}else{if(!z.length){A=false;}else{if(z.pop()!=matching[B]){A=false;}}}if(!z.length){break;}}else{if(C.dirty||!isSpan(C)&&!isBR(C)){return{node:C,status:"dirty"};}}}return{node:C,status:C&&A};}while(true){var x=r();if(x.status=="dirty"){this.highlight(x.node,j(x.node));x.node.dirty=false;continue;}else{n(v,x.status);n(x.node,x.status);if(l){parent.setTimeout(function(){t(v);t(x.node);},500);}else{w.highlighted=[v,x.node];}if(y&&x.node){select.focusAfterNode(x.node.previousSibling,this.container);}break;}}},indentAtCursor:function(k){if(!this.container.firstChild){return;}if(!this.highlightAtCursor()){return;}var l=select.selectionTopNode(this.container,false);if(l===false){return;}select.markSelection();this.indentLineAfter(h(l),k);select.selectMarked();},indentRegion:function(p,k,o){var n=(p=h(p)),m=p&&h(p.previousSibling);if(!isBR(k)){k=j(k,this.container);}this.addDirtyNode(p);do{var l=j(n,this.container);if(n){this.highlight(m,l,true);}this.indentLineAfter(n,o);m=n;n=l;}while(n!=k);select.setCursorPos(this.container,{node:p,offset:0},{node:k,offset:0});},cursorActivity:function(l){if(this.unloaded){window.document.designMode="off";window.document.designMode="on";this.unloaded=false;}if(internetExplorer){this.container.createTextRange().execCommand("unlink");clearTimeout(this.saveSelectionSnapshot);var k=this;this.saveSelectionSnapshot=setTimeout(function(){var o=select.getBookmark(k.container);if(o){k.selectionSnapshot=o;}},200);}var m=this.options.onCursorActivity;if(!l||m){var n=select.selectionTopNode(this.container,false);if(n===false||!this.container.firstChild){return;}n=n||this.container.firstChild;if(m){m(n);}if(!l){this.scheduleHighlight();this.addDirtyNode(n);}}},reparseBuffer:function(){forEach(this.container.childNodes,function(k){k.dirty=true;});if(this.container.firstChild){this.addDirtyNode(this.container.firstChild);}},addDirtyNode:function(l){l=l||this.container.firstChild;if(!l){return;}for(var k=0;k<this.dirty.length;k++){if(this.dirty[k]==l){return;}}if(l.nodeType!=3){l.dirty=true;}this.dirty.push(l);},allClean:function(){return !this.dirty.length;},scheduleHighlight:function(){var k=this;parent.clearTimeout(this.highlightTimeout);this.highlightTimeout=parent.setTimeout(function(){k.highlightDirty();},this.options.passDelay);},getDirtyNode:function(){while(this.dirty.length>0){var k=this.dirty.pop();try{while(k&&k.parentNode!=this.container){k=k.parentNode;}if(k&&(k.dirty||k.nodeType==3)){return k;}}catch(l){}}return null;},highlightDirty:function(m){if(!window||!window.parent||!window.select){return false;}if(!this.options.readOnly){select.markSelection();}var n,l=m?null:b()+this.options.passTime;while((b()<l||m)&&(n=this.getDirtyNode())){var k=this.highlight(n,l);if(k&&k.node&&k.dirty){this.addDirtyNode(k.node.nextSibling);}}if(!this.options.readOnly){select.selectMarked();}if(n){this.scheduleHighlight();}return this.dirty.length==0;},documentScanner:function(k){var l=this,m=null;return function(){if(!window||!window.parent||!window.select){return;}if(m&&m.parentNode!=l.container){m=null;}select.markSelection();var n=l.highlight(m,b()+k,true);select.selectMarked();var o=n?(n.node&&n.node.nextSibling):null;m=(m==o)?null:o;l.delayScanning();};},delayScanning:function(){if(this.scanner){parent.clearTimeout(this.documentScan);this.documentScan=parent.setTimeout(this.scanner,this.options.continuousScanning);}},highlight:function(z,D,B,v){var t=this.container,u=this,p=this.options.activeTokens;var n=(typeof D=="number"?D:null);if(!t.firstChild){return false;}while(z&&(!z.parserFromHere||z.dirty)){if(v!=null&&isBR(z)&&(--v)<0){return false;}z=z.previousSibling;}if(z&&!z.nextSibling){return false;}function q(F,E){return !E.reduced&&E.currentText==F.value&&E.className==F.style;}function l(E,F){E.currentText=E.currentText.substring(F);E.reduced=true;}function r(F){var E=makePartSpan(F.value);E.className=F.style;return E;}function A(F){if(F){var E=F.oldNextSibling;if(y||E===undefined||F.nextSibling!=E){u.history.touch(F);}F.oldNextSibling=F.nextSibling;}else{var E=u.container.oldFirstChild;if(y||E===undefined||u.container.firstChild!=E){u.history.touch(null);}u.container.oldFirstChild=u.container.firstChild;}}var m=d(z?z.nextSibling:t.firstChild),o=stringStream(m),s=z?z.parserFromHere(o):e.Parser.make(o);function w(E){return(E.previousSibling==null||isBR(E.previousSibling))&&(E.nextSibling==null||isBR(E.nextSibling));}var x={current:null,get:function(){if(!this.current){this.current=m.nodes.shift();}return this.current;},next:function(){this.current=null;},remove:function(){t.removeChild(this.get());this.current=null;},getNonEmpty:function(){var F=this.get();while(F&&isSpan(F)&&F.currentText==""){if(window.opera&&w(F)){this.next();F=this.get();}else{var E=F;this.remove();F=this.get();select.snapshotMove(E.firstChild,F&&(F.firstChild||F),0);}}return F;}};var y=false,C=true,k=0;forEach(s,function(G){var F=x.getNonEmpty();if(G.value=="\n"){if(!isBR(F)){throw"Parser out of sync. Expected BR.";}if(F.dirty||!F.indentation){y=true;}A(z);z=F;F.parserFromHere=s.copy();F.indentation=G.indentation||alwaysZero;F.dirty=false;if(n==null&&F==D){throw StopIteration;}if((n!=null&&b()>=n)||(!y&&!C&&k>1&&!B)){throw StopIteration;}C=y;y=false;k=0;x.next();}else{if(!isSpan(F)){throw"Parser out of sync. Expected SPAN.";}if(F.dirty){y=true;}k++;if(q(G,F)){if(p&&F.dirty){p(F,G,u);}F.dirty=false;x.next();}else{y=true;var E=r(G);t.insertBefore(E,F);if(p){p(E,G,u);}var J=G.value.length;var I=0;while(J>0){F=x.get();var H=F.currentText.length;select.snapshotReplaceNode(F.firstChild,E.firstChild,J,I);if(H>J){l(F,J);J=0;}else{J-=H;I+=H;x.remove();}}}}});A(z);webkitLastLineHack(this.container);return{node:x.getNonEmpty(),dirty:y};}};return e;})();addEventHandler(window,"load",function(){var a=window.frameElement.CodeMirror;var b=a.editor=new Editor(a.options);parent.setTimeout(method(a,"init"),0);});
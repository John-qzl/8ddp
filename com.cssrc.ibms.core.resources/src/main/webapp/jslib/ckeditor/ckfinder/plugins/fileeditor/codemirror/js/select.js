var select={};(function(){select.ie_selection=document.selection&&document.selection.createRangeCollection;function d(l,m){while(l&&l.parentNode!=m){l=l.parentNode;}return l;}function k(l,m){while(!l.previousSibling&&l.parentNode!=m){l=l.parentNode;}return d(l.previousSibling,m);}var f="\u00a0\u00a0\u00a0\u00a0";select.scrollToNode=function(E,n){if(!E){return;}var m=E,s=document.body,t=document.documentElement,A=!m.nextSibling||!m.nextSibling.nextSibling||!m.nextSibling.nextSibling.nextSibling;var p=0;while(m&&!m.offsetTop){p++;m=m.previousSibling;}if(p==0){A=false;}if(webkit&&m&&m.offsetTop==5&&m.offsetLeft==5){return;}var q=p*(m?m.offsetHeight:0),r=0,D=(E?E.offsetWidth:0),o=m;while(o&&o.offsetParent){q+=o.offsetTop;if(!isBR(o)){r+=o.offsetLeft;}o=o.offsetParent;}var C=s.scrollLeft||t.scrollLeft||0,B=s.scrollTop||t.scrollTop||0,l=false,z=window.innerWidth||t.clientWidth||0;if(n||D<z){if(n){var F=select.offsetInNode(E),w=nodeText(E).length;if(w){r+=D*(F/w);}}var v=r-C;if(v<0||v>z){C=r;l=true;}}var u=q-B;if(u<0||A||u>(window.innerHeight||t.clientHeight||0)-50){B=A?1000000:q;l=true;}if(l){window.scrollTo(C,B);}};select.scrollToCursor=function(l){select.scrollToNode(select.selectionTopNode(l,true)||l.firstChild,true);};var c=null;select.snapshotChanged=function(){if(c){c.changed=true;}};function i(n){var m=n.nextSibling;if(m){while(m.firstChild){m=m.firstChild;}if(m.nodeType==3||isBR(m)){return m;}else{return i(m);}}else{var l=n.parentNode;while(l&&!l.nextSibling){l=l.parentNode;}return l&&i(l);}}select.snapshotReplaceNode=function(p,o,m,n){if(!c){return;}function l(q){if(p==q.node){c.changed=true;if(m&&q.offset>m){q.offset-=m;}else{q.node=o;q.offset+=(n||0);}}else{if(select.ie_selection&&q.offset==0&&q.node==i(p)){c.changed=true;}}}l(c.start);l(c.end);};select.snapshotMove=function(q,p,o,m,n){if(!c){return;}function l(r){if(q==r.node&&(!n||r.offset==0)){c.changed=true;r.node=p;if(m){r.offset=Math.max(0,r.offset+o);}else{r.offset=o;}}}l(c.start);l(c.end);};if(select.ie_selection){function e(){var l=document.selection;return l&&(l.createRange||l.createTextRange)();}function g(l){var o=e();o.collapse(l);function p(u){var v=null;while(!v&&u){v=u.nextSibling;u=u.parentNode;}return n(v);}function n(u){while(u&&u.firstChild){u=u.firstChild;}return{node:u,offset:0};}var s=o.parentElement();if(!isAncestor(document.body,s)){return null;}if(!s.firstChild){return n(s);}var q=o.duplicate();q.moveToElementText(s);q.collapse(true);for(var r=s.firstChild;r;r=r.nextSibling){if(r.nodeType==3){var t=r.nodeValue.length;q.move("character",t);}else{q.moveToElementText(r);q.collapse(false);}var m=o.compareEndPoints("StartToStart",q);if(m==0){return p(r);}if(m==1){continue;}if(r.nodeType!=3){return n(r);}q.setEndPoint("StartToEnd",o);return{node:r,offset:t-q.text.length};}return p(s);}select.markSelection=function(){c=null;var m=document.selection;if(!m){return;}var n=g(true),l=g(false);if(!n||!l){return;}c={start:n,end:l,changed:false};};select.selectMarked=function(){if(!c||!c.changed){return;}function m(o){var p=document.body.createTextRange(),q=o.node;if(!q){p.moveToElementText(document.body);p.collapse(false);}else{if(q.nodeType==3){p.moveToElementText(q.parentNode);var r=o.offset;while(q.previousSibling){q=q.previousSibling;r+=(q.innerText||"").length;}p.move("character",r);}else{p.moveToElementText(q);p.collapse(true);}}return p;}var n=m(c.start),l=m(c.end);n.setEndPoint("StartToEnd",l);n.select();};select.offsetInNode=function(n){var m=e();if(!m){return 0;}var l=m.duplicate();try{l.moveToElementText(n);}catch(o){return 0;}m.setEndPoint("StartToStart",l);return m.text.length;};select.selectionTopNode=function(n,o){var t=e();if(!t){return false;}var v=t.duplicate();t.collapse(o);var u=t.parentElement();if(u&&isAncestor(n,u)){v.moveToElementText(u);if(t.compareEndPoints("StartToStart",v)==1){return d(u,n);}}function r(x,z){if(z.nodeType==3){var y=0,B=z.previousSibling;while(B&&B.nodeType==3){y+=B.nodeValue.length;B=B.previousSibling;}if(B){try{x.moveToElementText(B);}catch(A){return false;}x.collapse(false);}else{x.moveToElementText(z.parentNode);}if(y){x.move("character",y);}}else{try{x.moveToElementText(z);}catch(A){return false;}}return true;}var o=0,s=n.childNodes.length-1;while(o<s){var w=Math.ceil((s+o)/2),q=n.childNodes[w];if(!q){return false;}if(!r(v,q)){return false;}if(t.compareEndPoints("StartToStart",v)==1){o=w;}else{s=w-1;}}if(o==0){var m=e(),l=m.duplicate();try{l.moveToElementText(n);}catch(p){return null;}if(m.compareEndPoints("StartToStart",l)==0){return null;}}return n.childNodes[o]||null;};select.focusAfterNode=function(n,l){var m=document.body.createTextRange();m.moveToElementText(n||l);m.collapse(!n);m.select();};select.somethingSelected=function(){var l=e();return l&&(l.text!="");};function b(m){var l=e();if(l){l.pasteHTML(m);l.collapse(false);l.select();}}select.insertNewlineAtCursor=function(){b("<br>");};select.insertTabAtCursor=function(){b(f);};select.cursorPos=function(m,q){var n=e();if(!n){return null;}var o=select.selectionTopNode(m,q);while(o&&!isBR(o)){o=o.previousSibling;}var l=n.duplicate();n.collapse(q);if(o){l.moveToElementText(o);l.collapse(false);}else{try{l.moveToElementText(m);}catch(p){return null;}l.collapse(true);}n.setEndPoint("StartToStart",l);return{node:o,offset:n.text.length};};select.setCursorPos=function(m,p,o){function l(r){var q=document.body.createTextRange();if(!r.node){q.moveToElementText(m);q.collapse(true);}else{q.moveToElementText(r.node);q.collapse(false);}q.move("character",r.offset);return q;}var n=l(p);if(o&&o!=p){n.setEndPoint("EndToEnd",l(o));}n.select();};select.getBookmark=function(l){var n=select.cursorPos(l,true),m=select.cursorPos(l,false);if(n&&m){return{from:n,to:m};}};select.setBookmark=function(l,m){if(!m){return;}select.setCursorPos(l,m.from,m.to);};}else{function j(m,n){while(m.nodeType!=3&&!isBR(m)){var l=m.childNodes[n]||m.nextSibling;n=0;while(!l&&m.parentNode){m=m.parentNode;l=m.nextSibling;}m=l;if(!l){break;}}return{node:m,offset:n};}select.markSelection=function(){var m=window.getSelection();if(!m||m.rangeCount==0){return(c=null);}var l=m.getRangeAt(0);c={start:j(l.startContainer,l.startOffset),end:j(l.endContainer,l.endOffset),changed:false};};select.selectMarked=function(){var n=c;function o(){if(n.start.node==n.end.node&&n.start.offset==n.end.offset){var r=window.getSelection();if(!r||r.rangeCount==0){return true;}var q=r.getRangeAt(0),p=j(q.startContainer,q.startOffset);return n.start.node!=p.node||n.start.offset!=p.offset;}}if(!n||!(n.changed||(webkit&&o()))){return;}var m=document.createRange();function l(p,q){if(p.node){if(p.offset==0){m["set"+q+"Before"](p.node);}else{m["set"+q](p.node,p.offset);}}else{m.setStartAfter(document.body.lastChild||document.body);}}l(n.end,"End");l(n.start,"Start");h(m);};function h(l){var m=window.getSelection();if(!m){return;}m.removeAllRanges();m.addRange(l);}function a(){var l=window.getSelection();if(!l||l.rangeCount==0){return false;}else{return l.getRangeAt(0);}}select.selectionTopNode=function(l,p){var m=a();if(!m){return false;}var n=p?m.startContainer:m.endContainer;var o=p?m.startOffset:m.endOffset;if(window.opera&&!p&&m.endContainer==l&&m.endOffset==m.startOffset+1&&l.childNodes[m.startOffset]&&isBR(l.childNodes[m.startOffset])){o--;}if(n.nodeType==3){if(o>0){return d(n,l);}else{return k(n,l);}}else{if(n.nodeName.toUpperCase()=="HTML"){return(o==1?null:l.lastChild);}else{if(n==l){return(o==0)?null:n.childNodes[o-1];}else{if(o==n.childNodes.length){return d(n,l);}else{if(o==0){return k(n,l);}else{return d(n.childNodes[o-1],l);}}}}}};select.focusAfterNode=function(n,l){var m=document.createRange();m.setStartBefore(l.firstChild||l);if(n&&!n.firstChild){m.setEndAfter(n);}else{if(n){m.setEnd(n,n.childNodes.length);}else{m.setEndBefore(l.firstChild||l);}}m.collapse(false);h(m);};select.somethingSelected=function(){var l=a();return l&&!l.collapsed;};select.offsetInNode=function(m){var l=a();if(!l){return 0;}l=l.cloneRange();l.setStartBefore(m);return l.toString().length;};select.insertNodeAtCursor=function(q){var m=a();if(!m){return;}m.deleteContents();m.insertNode(q);webkitLastLineHack(document.body);if(window.opera&&isBR(q)&&isSpan(q.parentNode)){var o=q.nextSibling,r=q.parentNode,n=r.parentNode;n.insertBefore(q,r.nextSibling);var l="";for(;o&&o.nodeType==3;o=o.nextSibling){l+=o.nodeValue;removeElement(o);}n.insertBefore(makePartSpan(l,document),q.nextSibling);}m=document.createRange();m.selectNode(q);m.collapse(false);h(m);};select.insertNewlineAtCursor=function(){select.insertNodeAtCursor(document.createElement("BR"));};select.insertTabAtCursor=function(){select.insertNodeAtCursor(document.createTextNode(f));};select.cursorPos=function(l,p){var m=a();if(!m){return;}var n=select.selectionTopNode(l,p);while(n&&!isBR(n)){n=n.previousSibling;}m=m.cloneRange();m.collapse(p);if(n){m.setStartAfter(n);}else{m.setStartBefore(l);}var o=m.toString();return{node:n,offset:o.length};};select.setCursorPos=function(l,p,o){var n=document.createRange();function m(t,w,r){if(w==0&&t&&!t.nextSibling){n["set"+r+"After"](t);return true;}if(!t){t=l.firstChild;}else{t=t.nextSibling;}if(!t){return;}if(w==0){n["set"+r+"Before"](t);return true;}var u=[];function q(x){if(x.nodeType==3){u.push(x);}else{forEach(x.childNodes,q);}}while(true){while(t&&!u.length){q(t);t=t.nextSibling;}var v=u.shift();if(!v){return false;}var s=v.nodeValue.length;if(s>=w){n["set"+r](v,w);return true;}w-=s;}}o=o||p;if(m(o.node,o.offset,"End")&&m(p.node,p.offset,"Start")){h(n);}};}})();